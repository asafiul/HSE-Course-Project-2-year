{"extraResources":{"example.01.mu":"TVXzATMgMw0KMSAyIDMNCjEgMyA2DQo=","example.02.mu":"TVXzATMgMw0KMyAyIDENCjEgMyA2DQo=","example.03.mu":"TVXzATIgNQ0KMiAxDQoxIDMgNCA2IDcNCg=="},"scoring":"\\begin{center}\n\\begingroup\n\\unskip\n\\renewcommand{\\arraystretch}{1.5}\n\\begin{tabular}{|c|c|c|c|c|c|c|}\n\\hline\n& & \\multicolumn{4}{c|}{Ограничения} & \\\\\n\\cline{3-6}\n\\raisebox{2.25ex}[0cm][0cm]{Подз.}\n& \\raisebox{2.25ex}[0cm][0cm]{Баллы}\n& $n$ & $m$ & $t_i, s_i$ & Доп. ограничения \n& \\raisebox{2.25ex}[0cm][0cm]{\\parbox{2cm}{\\centering Необх. подзадачи}}\n\\\\\n\\hline\n1 & 5 & $n = 2$ & $m \\le 50$ & $t_i,s_i \\le 100\\,000$ & & \\\\\n\\hline\n2 & 7 & $n \\le 50$ & $m \\le 50$ & $t_i,s_i \\le 100\\,000$ & & У, 1 \\\\\n\\hline\n3 & 13 & $n \\le 1000$ & $m \\le 5$ & $t_i,s_i \\le 100\\,000$ & & У \\\\\n\\hline\n4 & 9 & $n \\le 100\\,000$ & $m \\le 100\\,000$ & $t_i,s_i \\le 100\\,000$ & \\parbox[c][1.5cm]{2.5cm}{\\centering $s_{i+1} - s_i = s_1$\\\\ для всех $1 \\le i < m$} &  \\\\\n\\hline\n5 & 8 & $n \\le 100\\,000$ & $m \\le 100\\,000$ & $t_i,s_i \\le 100\\,000$ & все $t_i$ равны &  \\\\\n\\hline\n6 & 10 & $n \\le 100$ & $m \\le 100\\,000$ & $t_i,s_i \\le 100\\,000$ & & У, 1 -- 2  \\\\\n\\hline\n7 & 5 & $n \\le 100\\,000$  & $m \\le 100\\,000$ & $t_i \\le 2$, $s_i \\le 100\\,000$ & &  \\\\\n\\hline\n8 & 7 & $n \\le 100\\,000$ & $m=2$ & $t_i,s_i \\le 100\\,000$ & & \\\\\n\\hline\n9 & 6 & $n \\le 10\\,000$ & $m \\le 100\\,000$ & $t_i,s_i \\le 100\\,000$ & & У, 1 -- 3, 6  \\\\\n\\hline\n10 & 6 & $n \\le 50\\,000$ &$m \\le 100\\,000$ & $t_i,s_i \\le 100\\,000$ & & У, 1 -- 3, 6, 9  \\\\\n\\hline\n11 & 8 & $n \\le 100\\,000$ &$m \\le 100\\,000$ & $t_i,s_i \\le 100\\,000$ & & У, 1 -- 10  \\\\\n\\hline\n12 & 8 & $n \\le 100\\,000$ & & & & У, 1 -- 11  \\\\\n\\hline\n13 & 8 & \\multicolumn{3}{c|}{без дополнительных ограничений} & & У, 1 -- 12  \\\\\n\\hline\n\n\\end{tabular}\n\\endgroup\n\\end{center}","notes":"Рассмотрим первый пример. \n\nЕсли $k = 1$, то телепортаций не происходит.\n\nЕсли $k=2$, то гонка происходит следующим образом. На рисунках показаны моменты, когда дроны оказываются в воротах и происходит телепортация.\n\n\\medskip\n\\begin{center}\n\\begin{tabular}{cc}\n\\renewcommand{\\arraystretch}{2}\n%>{\\centering}p{5cm}\n\\includegraphics[scale=0.7]{sample-2-01.eps}\\\\[0.8cm]\n\\includegraphics[scale=0.7]{sample-2-02.eps}\\\\[0.3cm]\n\\includegraphics[scale=0.7]{sample-2-03.eps}&{1 телепортация}\\\\[0.8cm]\n\\includegraphics[scale=0.7]{sample-2-04.eps}\\\\[0.3cm]\n\\includegraphics[scale=0.7]{sample-2-05.eps}&{+1 телепортация, итого 2}\\\\[0.8cm]\n\\includegraphics[scale=0.7]{sample-2-06.eps}\\\\[0.3cm]\n\\includegraphics[scale=0.7]{sample-2-07.eps}&{+1 телепортация, итого 3}\\\\[0.8cm]\n\\includegraphics[scale=0.7]{sample-2-08.eps}&дрон 1 финишировал\\\\[0.3cm]\n\\includegraphics[scale=0.7]{sample-2-09.eps}&{+1 телепортация, итого 4}\\\\[0.8cm]\n\\includegraphics[scale=0.7]{sample-2-10.eps}\\\\[0.8cm]\n\\includegraphics[scale=0.7]{sample-2-11.eps}&дрон 2 финишировал\\\\\n\\end{tabular}\n\\end{center}\n\nЕсли $k=3$, то гонка происходит следующим образом. На рисунках показаны моменты, когда дроны оказываются в воротах и происходит телепортация.\n\n\n\\begin{center}\n\\begin{tabular}{cc}\n\\includegraphics[scale=0.5]{sample-3-01.eps}\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-02.eps}&\n\\includegraphics[scale=0.5]{sample-3-03.eps}\\\\\n&2 телепортации\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-04.eps}&\n\\includegraphics[scale=0.5]{sample-3-05.eps}\\\\\n&+2 телепортации, итого 4\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-06.eps}&\n\\includegraphics[scale=0.5]{sample-3-07.eps}\\\\\n&+2 телепортации, итого 6\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-08.eps}&\n\\includegraphics[scale=0.5]{sample-3-09.eps}\\\\\nдрон 1 финишировал &+2 телепортации, итого 8\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-10.eps}&\n\\includegraphics[scale=0.5]{sample-3-11.eps}\\\\\n&+1 телепортация, итого 9\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-12.eps}&\n\\includegraphics[scale=0.5]{sample-3-13.eps}\\\\\n&+1 телепортация, итого 10\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-14.eps}&\n\\includegraphics[scale=0.5]{sample-3-15.eps}\\\\\nдрон 2 финишировал&+1 телепортация, итого 11\\\\[0.5cm]\n\\includegraphics[scale=0.5]{sample-3-16.eps}&\n\\includegraphics[scale=0.5]{sample-3-17.eps}\\\\\n&дрон 3 финишировал\\\\\n\\end{tabular}\n\\end{center}\n\n\n","legend":"В Иннополисе проводятся гонки дронов.\n\nВ гонке могут принять участие $n$ дронов, $i$-й дрон пролетает единицу расстояния за $t_i$ секунд.\nГонка проводится на прямой, на которой расположены $m$ ворот, пронумерованных от $1$ до $m$, $i$-е ворота находятся на расстоянии $s_i$ от стартовой позиции гонки.\n\nВ гонке примут участие первые $k$ дронов с номерами от $1$ до $k$. Величину $k$ судьи объявляют непосредственно перед гонкой, поэтому вам необходимо проанализировать гонку для всех $k$ от~$1$~до~$n$.\n\nГонка проводится следующим образом. \n\nДроны начинают движение из точки $0$ в сторону ворот, каждый со своей скоростью. У каждого дрона есть \\textit{точка восстановления} \"--- последние ворота, в которых он выполнял \\textit{сохранение позиции}. Изначально точка восстановления каждого дрона \"--- точка $0$. Дроны каждый раз начинают двигаться из своих точек восстановления и продолжают движение, пока один или несколько дронов не оказываются в точке, где расположены ворота (возможно, различные для разных дронов). В этот момент среди всех дронов, которые оказались в каких-либо воротах, выбирается дрон с наименьшим номером. Для этого дрона производится сохранение позиции, его точка восстановления переносится в его текущую позицию. Остальные дроны мгновенно телепортируются в свои точки восстановления. После этого гонка продолжается таким же образом. \n\nКак только дрон сохраняет позицию в последних воротах с номером $m$, он финиширует. Не финишировавшие пока дроны, как обычно, телепортируются в свои точки восстановления и продолжают гонку. Когда все дроны финишируют, гонка завершается.\n\nТелепортация \"--- очень энергоемкий процесс. Для подготовки к гонке необходимо понять, сколько суммарно телепортаций совершат все дроны до её завершения. Обозначим как $c_k$ суммарное число телепортаций, которое совершат все дроны, если в гонке будут участвовать первые $k$ дронов. Найдите значения $c_1, c_2, \\ldots, c_n$.","authorLogin":"asafiul","language":"russian","timeLimit":2000,"output":"Выведите $n$ целых чисел $c_1, c_2, \\ldots, c_n$.","inputFile":"stdin","outputFile":"stdout","input":"В первой строке даны два целых числа $n$ и $m$ \"--- количество дронов и ворот, соответственно ($2 \\le n \\le 150\\,000$, $1 \\le m \\le 150\\,000$).\n\nВо второй строке даны $n$ положительных целых чисел $t_1, t_2,...,t_n$, где $t_i$ \"--- количество секунд, за которое $i$-й дрон пролетает единицу расстояния ($1 \\le t_i \\le 10^9$).\n\nВ третьей строке даны $m$ положительных целых чисел $s_1, s_2,...,s_m$, где $s_i$ \"--- позиция $i$-х ворот на прямой ($1 \\le s_1 < s_2 < \\ldots < s_m \\le 150\\,000$).","authorName":"Azat Safiullin","sampleTests":[{"output":"0\n4\n11\n","input":"3 3\n1 2 3\n1 3 6\n","inputFile":"example.01","outputFile":"example.01.a"},{"output":"0\n5\n13\n","input":"3 3\n3 2 1\n1 3 6\n","inputFile":"example.02","outputFile":"example.02.a"},{"output":"0\n6\n","input":"2 5\n2 1\n1 3 4 6 7\n","inputFile":"example.03","outputFile":"example.03.a"}],"name":"Гонка дронов","interaction":null,"memoryLimit":536870912,"tutorial":"\\ifdefined\\tutorialbox \\tutorialbox{Азат Сафиуллин, Иван Сафонов}{Иван Сафонов, Азат Сафиуллин} \\fi\n\nВ первой подзадаче $n=2$. Достаточно пройтись двумя указателями по двум массивам, двигая указатель того дрона, который пролетает следующее расстояние быстрее (учитывая индексы дронов). $O(m)$\n\nВо второй подзадаче достаточно запустить гонку для каждого префикса $k$. Заводим $k$ указателей и двигаем указатель того дрона, который пролетает отрезок быстрее остальных (учитывая индексы). Получаем решение за $O(n^3 m)$.\n\nДля решения третьей подзадачи достаточно оптимизировать поиск дрона, который пролетит следующий отрезок быстрее всех. Это можно сделать структурой $Set$. $O(n^2 m \\log(n))$\n\nВ четвертой подзадаче расстояния между точками равны. Очевидно, что первым в гонке все расстояния подряд пролетит дрон с минимальной скоростью. Вторым пролетит дрон с минимальной скоростью из оставшихся и так далее. Таким образом, ответ можно вычислить формулой $\\frac{(k-1) k m}{2}$, где $k$ - текущий префикс. \n\nВ пятой подзадаче все скорости равны. Зафиксируем $p$ \"--- индекс левого вхождения максимального расстояния между ближайшими точками. Очевидно, что все отрезки левее $p$ имеют длину меньше. Поэтому в гонке будет момент, когда все дроны соберутся в точке $p$. Поскольку никакой дрон не может пролететь отрезок максимальной длины быстрее, чем какой-то дрон, который находится левее $p$. Понятно, что, как только какой-то дрон пролетит максимальное расстояние, он будет лететь до конца непрерывно. А это эквивалентно решению подзадачи $4$. То ответ для префикса $k$ будет равен $(p-1) k (k-1) + \\frac{(k-1) k (m-p+1)}{2}$.\n\nОбратим внимание на рекорды слева направо в строго возрастающем порядке. Нетрудно понять, что при преодолении дроном какого-то рекорда, он же продолжит непрерывно лететь до следующего, поскольку до следующего рекорда будут встречаться отрезки не больше текущего рекорда. Таким образом, можно <<сжать>> количество отрезков, определив за каждым рекордом количество не больших отрезков за ним. Нетрудно доказать, что количество рекордов не больше $\\sqrt{s_m}$.\n\n\nВ шестой подзадаче $n \\le 100$. Сожмем в рекорды. Запустим решение подзадачи $3$. Получаем решение за $O(n^2 \\sqrt{s_m} \\log(n))$.\n\nВ седьмой подзадаче $t_i \\le 2$. Будем поддерживать ответ на префиксе. Когда добавляется новый дрон, достаточно добавить к ответу количество телепортаций, которое совершит этот дрон и количество вынужденных телепортаций других дронов, которые были созданы новым дроном. Это нетрудно посчитать, разобрав случаи $t_i = 1$ или $t_i = 2$. \n\nПусть $d_1 = s_1$ и $d_i = s_i-s_{i-1}$ (для каждого $1<i$)\n\nПоддерживаем ответ. Будем его обновлять после добавления нового дрона $i$.\n\nЕсть два случая:\n\n\\begin{enumerate}\n\\item когда другие вынуждают телепортироваться $i$.\n\\item когда $i$ вынуждает телепортироваться других.\n\\end{enumerate}\n\nПереберем рекорд $u$ и будем искать подходящие под условия дроны\n\n\\begin{enumerate}\n\\item $t_i\\cdot d_m \\geq t_j\\cdot d_u$, т.е. ищем такие $j$, что $i$-й еще не финишировал (эквивалентно непрохождению $i$-м последнего рекорда).\n\\item $t_i\\cdot d_u < t_j\\cdot d_m$, т.е. ищем такие $j$, что еще не финишировали (эквивалентно непрохождению $j$-м последнего рекорда).\n\\end{enumerate}\n\nТакие $j$ можно искать корневой декомпозицией. Добавлений не больше $O(n)$, а количество запросов не больше $O(n\\cdot \\sqrt{s_m})$. Таким образом, добавление хотим выполнить за $O(\\sqrt{t_m})$, а запрос $O(1)$. Получаем решение за $O(n (\\sqrt{s_m} + \\sqrt{maxv}))$.\n\nДанная идея с реализацией проходит $11$ подзадач. \n\nДля полного решения давайте отсортируем значения $t_{p_1} \\leq t_{p_2} \\leq \\ldots \\leq t_{p_n}$. Будем перебирать индексы в порядке возрастания значений $t$, то есть перебирать $p_i$. Тогда для всех $1 \\leq u \\leq m$ будем поддерживать указатели $ptr_1[u]$ --- максимальное значение $j$, такое что $t_{p_i}\\cdot d_m \\geq t_{p_j}\\cdot d_u$ и $ptr_2[u]$ --- минимальное значение $j$, такое что $t_{p_i}\\cdot d_u < t_{p_j}\\cdot d_m$. Поскольку мы перебираем значения в порядке возрастания, мы можем двигать указатели.\n\nПосмотрим как меняется ответ в момент времени $p_i$. В неравенствах, написанных выше участвуют все индексы $p_j$ по $j \\leq ptr_1[u]$ или $j \\geq ptr_2[u]$ по всем $1 \\leq u \\leq m$. Но среди них нужно оставить только $p_j < p_i$. Давайте сделаем массив длины $n$, где в индексе $x$ будем хранить добавку, которую дает элемент с индексом $x$. В этой структуре данных нужно $O(n \\sqrt{s_m})$ прибавлять к индексу (при движениях указателей) и $n$ раз считать сумму на префиксе. Тогда если применить для этого массива корневую декомпозицию, получится полное решение.\n\nМы нигде не использовали, что $t_i$ маленькие. Время работы $O(n (\\sqrt{s_m} + \\sqrt{n}))$, память $O(n)$.\n"}
